<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Takeoff News - Dynamic Newsletter Builder</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        .controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls h2 {
            margin-top: 0;
            color: #1f2937;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            border-radius: 6px;
            padding: 15px;
            color: #dc2626;
            margin-bottom: 20px;
        }
        .generate-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .generate-btn:hover {
            background: #047857;
        }
        .generate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .selections {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 100px;
        }
        .selection-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .selection-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }
        .newsletter {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, #10b981, #14b8a6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        .content {
            padding: 30px;
        }
        .welcome {
            font-size: 16px;
            margin-bottom: 25px;
            color: #4b5563;
        }
        .brief-header {
            background: linear-gradient(90deg, #1f2937, #374151);
            color: white;
            padding: 20px 30px;
            margin: 0 -30px 25px -30px;
        }
        .brief-header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
        }
        .brief-header .date {
            opacity: 0.8;
            font-size: 14px;
            margin-top: 5px;
        }
        .story {
            margin-bottom: 25px;
            border-left: 4px solid #e5e7eb;
            padding-left: 20px;
            position: relative;
        }
        .story.politics { border-left-color: #fbbf24; }
        .story.conflict { border-left-color: #ef4444; }
        .story.diplomacy { border-left-color: #3b82f6; }
        .story.military { border-left-color: #fbbf24; }
        .story.intelligence { border-left-color: #ef4444; }
        .story.news { border-left-color: #6b7280; }
        
        .story-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .story-emoji {
            font-size: 18px;
            margin-right: 8px;
        }
        .story-title {
            font-weight: 700;
            font-size: 18px;
            color: #1f2937;
            margin: 0;
        }
        .story-location {
            color: #6b7280;
            font-style: italic;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .story-content {
            color: #374151;
            font-size: 15px;
            line-height: 1.6;
        }
        .story-images {
            margin: 15px 0;
        }
        .story-images.no-images {
            display: none;
        }
        .image-container {
            background: #f3f4f6;
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }
        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }
        .images-grid {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }
        .images-grid.layout-single { grid-template-columns: 1fr; }
        .images-grid.layout-side-by-side { grid-template-columns: 1fr 1fr; }
        .images-grid.layout-three { grid-template-columns: repeat(3, 1fr); }
        .images-grid.layout-stacked { grid-template-columns: 1fr; }
        
        .image-controls {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .image-controls h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #374151;
        }
        .controls-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .control-group label {
            font-size: 12px;
            color: #6b7280;
            min-width: 45px;
        }
        .control-group input, .control-group select {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 3px;
            font-size: 12px;
            width: 70px;
        }
        .control-group select {
            width: 120px;
        }
        .selected-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            min-height: 60px;
        }
        .selected-image {
            position: relative;
            width: 80px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            border: 2px solid #10b981;
        }
        .selected-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .remove-image {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clear-images {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            background: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .image-option {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .image-option:hover {
            border-color: #10b981;
            transform: scale(1.05);
        }
        .image-option.selected {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        .gallery-toggle {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
        }
        .gallery-toggle:hover {
            background: #059669;
        }
        .gallery-hidden {
            display: none;
        }
        .insight {
            background: #f3f4f6;
            border-radius: 6px;
            padding: 20px;
            margin: 25px 0;
            border-left: 4px solid #10b981;
        }
        .insight-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
        }
        .cta {
            background: #f8fafc;
            padding: 20px;
            border-radius: 6px;
            margin: 25px 0;
            text-align: center;
        }
        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            margin: 25px -30px 0 -30px;
            font-size: 14px;
            color: #6b7280;
        }
        .signature {
            margin: 20px 0;
            font-style: italic;
        }
        .unsubscribe {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 15px;
        }
        .export-btn {
            background: #1f2937;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        .export-btn:hover {
            background: #374151;
        }
        .story-meta {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h2>ðŸŽ¨ Dynamic Newsletter Builder</h2>
        <p>Generate newsletter from latest reports with real Discord images.</p>
        
        <button class="generate-btn" onclick="generateNewsletter()" id="generateBtn">ðŸ”„ Generate from Latest Reports</button>
        <button class="export-btn" onclick="exportNewsletter()" id="exportBtn" disabled>ðŸ“§ Export Final Newsletter HTML</button>
        
        <div id="errorMessage"></div>
        
        <h3>Selected Images:</h3>
        <div class="selections" id="selections">
            <p style="color: #6b7280; font-style: italic;">Generate newsletter to start selecting images.</p>
        </div>
    </div>

    <div id="loadingMessage" class="loading" style="display: none;">
        <p>ðŸ”„ Loading newsletter data...</p>
    </div>

    <div class="newsletter" id="newsletter" style="display: none;">
        <div class="header">
            <h1>Fast Takeoff News</h1>
            <p>AI-Powered Intelligence Briefing</p>
        </div>
        
        <div class="content">
            <div class="welcome">
                <p><strong>Hi there,</strong></p>
                <p>Welcome to Fast Takeoff News! You're now part of a small, exclusive group of early subscribers getting AI-powered news intelligence straight from global sources.</p>
                <p><strong>What you'll get:</strong> Real-time analysis of breaking news from channels monitoring everything from US politics to Myanmar resistance movements, compiled by AI and verified by human oversight.</p>
            </div>
            
            <div class="brief-header">
                <h2>Today's Intelligence Brief</h2>
                <div class="date" id="briefDate"></div>
            </div>
            
            <div id="storiesContainer">
                <!-- Stories will be dynamically generated here -->
            </div>
            
            <div class="insight">
                <div class="insight-title">Why this matters:</div>
                These aren't just headlines - they're intelligence patterns. Notice how multiple stories connect across regions and domains, revealing the interconnected nature of global events.
            </div>
            
            <div class="cta">
                <p><strong>What's next:</strong> I'm personally curating these briefings and would love your feedback. What type of analysis interests you most? Geopolitical trends? Economic intelligence? Regional conflicts?</p>
                <p>Just reply to this email - I read every response personally.</p>
            </div>
            
            <div class="signature">
                <p>Best,<br>
                <strong>Guilherme</strong><br>
                Founder, Fast Takeoff News</p>
            </div>
            
            <div class="footer">
                <p><strong>P.S.</strong> - If you know someone who'd value real-time intelligence analysis, share: <a href="https://news.fasttakeoff.org">news.fasttakeoff.org</a></p>
                
                <div class="unsubscribe">
                    <p><em>You're receiving this because you signed up at news.fasttakeoff.org. Unsubscribe anytime.</em></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedImages = {}; // Now stores arrays: { 'story-0': [imageData, ...] }
        let storySettings = {}; // Stores layout and dimensions: { 'story-0': { layout: 'single', width: 400, height: 300 } }
        const newsletterData = {
  "generatedAt": "2025-09-11T20:44:18.987Z",
  "date": "September 11, 2025",
  "stories": [
    {
      "id": "53e8ffac-7cac-4956-9582-acb97a119901",
      "title": "SMOLENSK HIT BY LARGE-SCALE UAV ATTACK AMID BORDER INCURSIONS",
      "location": "Smolensk",
      "content": "Smolensk, Russia, is experiencing a large-scale UAV attack with numerous explosions and fires reported within the city and surrounding region. Russian sources indicate over 115 Ukrainian drones have crossed into the Bryansk region, predominantly moving east and north, with many of these drones repor...",
      "category": "conflict",
      "emoji": "ðŸ”´",
      "color": "#ef4444",
      "channelId": "1108893038757036052",
      "channelName": "ðŸ”´ukraine-russia-live",
      "messageCount": 4,
      "availableImages": [],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:30:58.829Z"
    },
    {
      "id": "e928d5fa-5200-4b7c-a88c-d4aff70f44aa",
      "title": "GERMAN BUNDESTAG LIFTS MAXIMILIAN KRAH'S IMMUNITY",
      "location": "Berlin",
      "content": "The German Bundestag lifted the immunity of Alternative for Germany (AfD) politician Maximilian Krah on September 11th, allowing for potential searches related to bribery and money laundering allegations. The confirmation of this action occurred within the reporting window of September 11th, 2025, b...",
      "category": "news",
      "emoji": "ðŸ“°",
      "color": "#6b7280",
      "channelId": "1109236942765310072",
      "channelName": "ðŸ”µcontinental-europe",
      "messageCount": 1,
      "availableImages": [],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:31:43.951Z"
    },
    {
      "id": "cfc57f64-2afb-4b80-a8d9-63beee415a90",
      "title": "UNSPECIFIED EVENT REPORTED ON SOCIAL MEDIA",
      "location": "Unknown",
      "content": "A social media post on X by user JohnSevenTwo at an unspecified time on September 11th, 2025, indicates an event occurred, but provides no further details or context. The post, which has a URL pointing to a status update, does not specify the nature of the event, its location, or the individuals inv...",
      "category": "news",
      "emoji": "ðŸ“°",
      "color": "#6b7280",
      "channelId": "1174030918126682183",
      "channelName": "ðŸŸ myanmar",
      "messageCount": 1,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1174030918126682183/1415789909825818646/antilleanfeline.png?ex=68c47c9a&is=68c32b1a&hm=bfbba0560ce91a4612127fdbc8c4820a0cb94933a2caad8374360b23618c6c77&",
          "filename": "antilleanfeline.png",
          "width": 456,
          "height": 830,
          "description": "Image from FaytuksBot: antilleanfeline.png",
          "messageId": "1415789908995342349",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:17:04.169Z"
    },
    {
      "id": "0de8b1e7-8801-4732-a81d-af060edf0b53",
      "title": "CHARLIE KIRK ASSASSINATION INVESTIGATION CONTINUES; SUSPECT LOCATION IDENTIFIED",
      "location": "Orem",
      "content": "Photos released on September 11th, 2025, show the suspected shooter's vantage point on a nearby building's roof during the assassination of conservative commentator Charlie Kirk in Orem, Utah, on September 10th. Kirk was speaking at a Turning Point USA event on the campus of Utah Valley University w...",
      "category": "politics",
      "emoji": "ðŸŸ¡",
      "color": "#fbbf24",
      "channelId": "1312302264203087963",
      "channelName": "ðŸŸ¡us-politics-live",
      "messageCount": 3,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1312302264203087963/1415791914816372897/butjeprutje.jpg?ex=68c47e78&is=68c32cf8&hm=a8f4fea13df7d3211990a0b49402cfd11559ba93ea8d9805ea19bb2ae806affc&",
          "filename": "butjeprutje.jpg",
          "width": 1024,
          "height": 768,
          "description": "Image from FaytuksBot: butjeprutje.jpg",
          "messageId": "1415791913725984890",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:16:16.261Z"
    },
    {
      "id": "342a3cf3-9c41-42a6-9da1-2fece9e497bc",
      "title": "MASSIVE UAV ATTACK REPORTED IN SMOLENSK",
      "location": "Smolensk",
      "content": "Smolensk is currently under a massive UAV attack, according to reports from Exilenova+.\n\nAt the DSEI arms fair in London, Ukrainian officials met with Rheinmetall CEO Armin Papperger. They finalized plans for a new plant in a secure Ukrainian region to produce Rheinmetall shells for the Armed Forces...",
      "category": "conflict",
      "emoji": "ðŸ”´",
      "color": "#ef4444",
      "channelId": "1108893038757036052",
      "channelName": "ðŸ”´ukraine-russia-live",
      "messageCount": 2,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1108893038757036052/1415789949428695163/anzeeeeee.jpg?ex=68c47ca4&is=68c32b24&hm=dc3c0f3445c2df41cdcdb8052e64d6df5f4607febd5a7e7603848907d3b227ac&",
          "filename": "anzeeeeee.jpg",
          "width": 1280,
          "height": 853,
          "description": "Image from FaytuksBot: anzeeeeee.jpg",
          "messageId": "1415789948950286528",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:16:15.756Z"
    },
    {
      "id": "8adbba3e-a2be-4a4a-89a2-d8a1eb32ad22",
      "title": "BUNDESTAG LIFTS IMMUNITY OF AF D POLITICIAN MAXIMILIAN KRAH AMID ALLEGATIONS",
      "location": "Berlin",
      "content": "The German Bundestag has lifted the immunity of AfD politician Maximilian Krah, the Bundestag confirmed on September 11th. The decision means Krah can now face searches related to allegations of bribery and money laundering.\n\nThis development, occurring within the current reporting window, signifies...",
      "category": "news",
      "emoji": "ðŸ“°",
      "color": "#6b7280",
      "channelId": "1109236942765310072",
      "channelName": "ðŸ”µcontinental-europe",
      "messageCount": 1,
      "availableImages": [],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:02:02.746Z"
    },
    {
      "id": "2dfc2141-1186-4e66-b807-a7c043d987b3",
      "title": "CHARLIE KIRK ASSASSINATION CONTINUES TO SHAPE CONGRESSIONAL ATMOSPHERE; POPULATION GROWTH FORECAST REVISED",
      "location": "Washington",
      "content": "Lawmakers are reportedly fearful for their safety following the assassination of Charlie Kirk, with some changing their behavior by canceling events or carrying firearms, according to NBC News reporting on September 11th, 2025. This heightened concern for security is occurring as the U.S. Coast Guar...",
      "category": "politics",
      "emoji": "ðŸŸ¡",
      "color": "#fbbf24",
      "channelId": "1312302264203087963",
      "channelName": "ðŸŸ¡us-politics-live",
      "messageCount": 13,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1312302264203087963/1415788890077270067/juiceboxed..jpg?ex=68c47ba7&is=68c32a27&hm=235b7e37e31273ea951a462a2100946504d9f426b4137864a989df22dd2500ca&",
          "filename": "juiceboxed..jpg",
          "width": 1035,
          "height": 665,
          "description": "Image from FaytuksBot: juiceboxed..jpg",
          "messageId": "1415788889683132468",
          "author": "FaytuksBot"
        },
        {
          "url": "https://cdn.discordapp.com/attachments/1312302264203087963/1415788023748104212/juiceboxed..png?ex=68c47ad8&is=68c32958&hm=cb21ab2446e149d5324087cc971daadd5f8a2b6e8ed408d7ef31749aa150e302&",
          "filename": "juiceboxed..png",
          "width": 583,
          "height": 598,
          "description": "Image from FaytuksBot: juiceboxed..png",
          "messageId": "1415788023190392966",
          "author": "FaytuksBot"
        },
        {
          "url": "https://cdn.discordapp.com/attachments/1312302264203087963/1415787837726392320/juiceboxed..jpg?ex=68c47aac&is=68c3292c&hm=5cb884afe79a3bf255227245a00fe2a95ca4a247430b9bdf9e692e3337139f20&",
          "filename": "juiceboxed..jpg",
          "width": 1100,
          "height": 1132,
          "description": "Image from FaytuksBot: juiceboxed..jpg",
          "messageId": "1415787837227536388",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T20:01:13.781Z"
    },
    {
      "id": "e079202c-196c-4d4c-8f21-92f2175b9492",
      "title": "BELARUSIAN PRISONERS SELECTED PASSPORTS BEFORE DEPARTURE; DENMARK ANNOUNCES MAJOR DEFENSE SPENDING",
      "location": "Vilnius",
      "content": "At least some Belarusian political prisoners had their passports selected prior to their departure from Belarus, according to blogger Igor Losik, an employee of Radiosvaboda, as reported by Nasha Niva. This development emerged as 52 Belarusian political prisoners, including six Lithuanians, arrived ...",
      "category": "news",
      "emoji": "ðŸ“°",
      "color": "#6b7280",
      "channelId": "1109236942765310072",
      "channelName": "ðŸ”µcontinental-europe",
      "messageCount": 3,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1109236942765310072/1415784645110534214/4b5890d29bc6202f.jpg?ex=68c477b3&is=68c32633&hm=0bd164bc3f80541c2782c50bcd118058fe139a09752aced432a5712e8b67a2be&",
          "filename": "4b5890d29bc6202f.jpg",
          "width": 800,
          "height": 679,
          "description": "Image from FaytuksBot: 4b5890d29bc6202f.jpg",
          "messageId": "1415784644837769357",
          "author": "FaytuksBot"
        },
        {
          "url": "https://cdn.discordapp.com/attachments/1109236942765310072/1415783568873099294/anzeeeeee.jpg?ex=68c476b2&is=68c32532&hm=e45202597d2bd56ab6f67bfdbdfdae881f86ee2bc3343d7132a813aecebe5da2&",
          "filename": "anzeeeeee.jpg",
          "width": 942,
          "height": 471,
          "description": "Image from FaytuksBot: anzeeeeee.jpg",
          "messageId": "1415783568747139214",
          "author": "FaytuksBot"
        },
        {
          "url": "https://cdn.discordapp.com/attachments/1109236942765310072/1415782427699445841/beschkueb.jpg?ex=68c475a2&is=68c32422&hm=107c3291d9d5e923e98cf5aec3d013d8a6c033204dfbde9dfd62620636a2d2cf&",
          "filename": "beschkueb.jpg",
          "width": 702,
          "height": 366,
          "description": "Image from FaytuksBot: beschkueb.jpg",
          "messageId": "1415782427321696357",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T19:46:56.632Z"
    },
    {
      "id": "d521bf4a-a97b-4bce-afdc-6779d37d7ebf",
      "title": "ROCKET INCIDENT IN VOLYN, RUSSIA-UKRAINE CONFLICT DEVELOPMENTS",
      "location": "Volyn",
      "content": "A rocket fell on a residential building in the village of Kopillia, Volyn region, on September 11th, 2025, destroying the structure but causing no injuries, according to media reports. This incident occurred within the current reporting window.\n\nIn other developments, explosions were reported in Sum...",
      "category": "conflict",
      "emoji": "ðŸ”´",
      "color": "#ef4444",
      "channelId": "1108893038757036052",
      "channelName": "ðŸ”´ukraine-russia-live",
      "messageCount": 5,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1108893038757036052/1415784803646570526/anzeeeeee.jpg?ex=68c477d9&is=68c32659&hm=ef1185bee3a5251d5d14f55a7d408a1269a9138f61b58d2aa7a6eaaa368eb875&",
          "filename": "anzeeeeee.jpg",
          "width": 849,
          "height": 658,
          "description": "Image from FaytuksBot: anzeeeeee.jpg",
          "messageId": "1415784803147710607",
          "author": "FaytuksBot"
        },
        {
          "url": "https://cdn.discordapp.com/attachments/1108893038757036052/1415783965062598706/poztreck.jpg?ex=68c47711&is=68c32591&hm=f33807ff24e8aaad267efc4e20341751270304997f7519d61e9586b6d398c5dc&",
          "filename": "poztreck.jpg",
          "width": 1195,
          "height": 633,
          "description": "Image from FaytuksBot: poztreck.jpg",
          "messageId": "1415783964748152954",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T19:46:08.169Z"
    },
    {
      "id": "249db0b8-fec0-45c7-8834-a0a2b9f8516e",
      "title": "US COAST GUARD INVESTIGATES SOCIAL MEDIA ACTIVITY AMID POLITICAL VIOLENCE CONCERNS FOLLOWING CHARLIE KIRK ASSASSINATION",
      "location": "Washington",
      "content": "The U.S. Coast Guard is investigating inappropriate personal social media activity by a member concerning recent political violence, stating the behavior is contrary to core values, according to a statement released on X at approximately 7:36 PM UTC. The investigation, supported by the Department of...",
      "category": "politics",
      "emoji": "ðŸŸ¡",
      "color": "#fbbf24",
      "channelId": "1312302264203087963",
      "channelName": "ðŸŸ¡us-politics-live",
      "messageCount": 4,
      "availableImages": [
        {
          "url": "https://cdn.discordapp.com/attachments/1312302264203087963/1415782257498783855/dosithedos.jpg?ex=68c4757a&is=68c323fa&hm=4306806742b466efaf1677e4a3eebe0df341dd7d94fff64d7bfec072d54e9fb3&",
          "filename": "dosithedos.jpg",
          "width": 1170,
          "height": 902,
          "description": "Image from FaytuksBot: dosithedos.jpg",
          "messageId": "1415782257179754552",
          "author": "FaytuksBot"
        }
      ],
      "timeframe": "dynamic",
      "generatedAt": "2025-09-11T19:46:07.452Z"
    }
  ]
};
        
        async function generateNewsletter() {
            const generateBtn = document.getElementById('generateBtn');
            const loadingMessage = document.getElementById('loadingMessage');
            const newsletter = document.getElementById('newsletter');
            const errorMessage = document.getElementById('errorMessage');
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'ðŸ”„ Generating...';
            loadingMessage.style.display = 'block';
            newsletter.style.display = 'none';
            errorMessage.innerHTML = '';
            
            try {
                // Check if data is embedded (generated version)
                if (typeof newsletterData !== 'undefined' && newsletterData !== null) {
                    buildNewsletter();
                    return;
                }

                // Try server-side API first (no script needed)
                try {
                    const base = (window.location.protocol === 'file:') ? 'https://news.fasttakeoff.org' : '';
                    const apiResp = await fetch(`${base}/api/newsletter-data?limit=10`, { headers: { 'Accept': 'application/json' } });
                    if (apiResp.ok) {
                        newsletterData = await apiResp.json();
                        buildNewsletter();
                        return;
                    }
                } catch (e) {
                    console.warn('API fetch failed, will try local JSON next.', e);
                }

                // Fallback: try to load from local JSON file (requires generator script)
                try {
                    const response = await fetch('./newsletter-data.json');
                    if (!response.ok) {
                        throw new Error('Newsletter data not found.');
                    }
                    newsletterData = await response.json();
                    buildNewsletter();
                } catch (e) {
                    throw new Error('Newsletter data not found via API or local file. Either open this page on news.fasttakeoff.org or run: node scripts/generate-newsletter-data-kv.js');
                }
                
            } catch (error) {
                console.error('Error loading newsletter data:', error);
                errorMessage.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ðŸ”„ Generate from Latest Reports';
                loadingMessage.style.display = 'none';
            }
        }
        
        function buildNewsletter() {
            if (!newsletterData) return;
            
            // Update date
            document.getElementById('briefDate').textContent = newsletterData.date;
            
            // Build stories
            const storiesContainer = document.getElementById('storiesContainer');
            storiesContainer.innerHTML = '';
            
            newsletterData.stories.forEach((story, index) => {
                const storyElement = createStoryElement(story, index);
                storiesContainer.appendChild(storyElement);
            });
            
            // Show newsletter and enable export
            document.getElementById('newsletter').style.display = 'block';
            document.getElementById('exportBtn').disabled = false;
            
            // Reset selections
            selectedImages = {};
            storySettings = {};
            updateSelections();
        }
        
        function createStoryElement(story, index) {
            const storyDiv = document.createElement('div');
            storyDiv.className = `story ${story.category}`;
            storyDiv.dataset.story = `story-${index}`;
            
            const storyId = `story-${index}`;
            const hasImages = story.availableImages && story.availableImages.length > 0;
            
            // Initialize settings for this story
            storySettings[storyId] = {
                layout: 'single',
                width: 600,
                height: 300
            };
            selectedImages[storyId] = [];
            
            storyDiv.innerHTML = `
                <div class="story-header">
                    <span class="story-emoji">${story.emoji}</span>
                    <h3 class="story-title">${story.title}</h3>
                </div>
                <div class="story-location">${story.location}</div>
                <div class="story-meta">
                    ${story.channelName} â€¢ ${story.messageCount} messages â€¢ ${story.timeframe}
                </div>
                
                <div class="image-controls">
                    <h4>ðŸ“¸ Image Settings</h4>
                    <div class="controls-row">
                        <div class="control-group">
                            <label>Layout:</label>
                            <select onchange="updateLayout('${storyId}', this.value)">
                                <option value="single">Single</option>
                                <option value="side-by-side">Side by Side</option>
                                <option value="three">Three Column</option>
                                <option value="stacked">Stacked</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Width:</label>
                            <input type="number" value="600" min="100" max="800" onchange="updateDimensions('${storyId}', 'width', this.value)" />
                        </div>
                        <div class="control-group">
                            <label>Height:</label>
                            <input type="number" value="300" min="100" max="600" onchange="updateDimensions('${storyId}', 'height', this.value)" />
                        </div>
                        <button class="clear-images" onclick="clearImages('${storyId}')">Clear All</button>
                    </div>
                    
                    <div class="selected-images" id="selected-${storyId}">
                        <p style="color: #6b7280; font-style: italic; margin: 0;">No images selected</p>
                    </div>
                </div>
                
                <div class="story-images" id="images-${storyId}">
                    <!-- Selected images will appear here -->
                </div>
                
                <button class="gallery-toggle" onclick="toggleGallery('${storyId}')">
                    Choose Images (${story.availableImages.length} available)
                </button>
                <div class="image-gallery gallery-hidden" id="gallery-${storyId}">
                    ${hasImages ? 
                        story.availableImages.map((img, imgIndex) => `
                            <img class="image-option" 
                                 src="${img.url}" 
                                 onclick="addImage('${storyId}', this, ${imgIndex})" 
                                 data-description="${img.description}"
                                 data-author="${img.author}"
                                 data-filename="${img.filename}"
                                 data-index="${imgIndex}"
                                 title="${img.description}" />
                        `).join('') :
                        '<p style="color: #6b7280; font-style: italic; padding: 20px; text-align: center;">No images available for this story</p>'
                    }
                </div>
                
                <div class="story-content">
                    ${story.content}
                </div>
            `;
            
            return storyDiv;
        }
        
        function toggleGallery(storyId) {
            const gallery = document.getElementById(`gallery-${storyId}`);
            gallery.classList.toggle('gallery-hidden');
        }
        
        function addImage(storyId, element, imgIndex) {
            // Ensure arrays exist
            if (!selectedImages[storyId]) {
                selectedImages[storyId] = [];
            }
            if (!storySettings[storyId]) {
                storySettings[storyId] = { layout: 'single', width: 600, height: 300 };
            }
            
            const imageData = {
                src: element.src,
                description: element.dataset.description || 'Image',
                author: element.dataset.author || 'unknown',
                filename: element.dataset.filename || 'image',
                index: imgIndex
            };
            
            // Check if already selected
            const existing = selectedImages[storyId].find(img => img.index === imgIndex);
            if (existing) {
                // Remove if already selected
                selectedImages[storyId] = selectedImages[storyId].filter(img => img.index !== imgIndex);
                element.classList.remove('selected');
            } else {
                // Add to selection
                selectedImages[storyId].push(imageData);
                element.classList.add('selected');
            }
            
            // Update displays
            updateSelectedImagesDisplay(storyId);
            updateStoryImagesDisplay(storyId);
            updateSelections();
        }
        
        function removeImage(storyId, imgIndex) {
            if (!selectedImages[storyId]) return;
            
            selectedImages[storyId] = selectedImages[storyId].filter(img => img.index !== imgIndex);
            
            // Update gallery selection state
            const galleryImg = document.querySelector(`#gallery-${storyId} [data-index="${imgIndex}"]`);
            if (galleryImg) galleryImg.classList.remove('selected');
            
            // Update displays
            updateSelectedImagesDisplay(storyId);
            updateStoryImagesDisplay(storyId);
            updateSelections();
        }
        
        function clearImages(storyId) {
            if (!selectedImages[storyId]) {
                selectedImages[storyId] = [];
            } else {
                selectedImages[storyId] = [];
            }
            
            // Clear gallery selections
            const gallery = document.getElementById(`gallery-${storyId}`);
            if (gallery) {
                gallery.querySelectorAll('.image-option').forEach(img => {
                    img.classList.remove('selected');
                });
            }
            
            // Update displays
            updateSelectedImagesDisplay(storyId);
            updateStoryImagesDisplay(storyId);
            updateSelections();
        }
        
        function updateLayout(storyId, layout) {
            if (!storySettings[storyId]) {
                storySettings[storyId] = { layout: 'single', width: 600, height: 300 };
            }
            storySettings[storyId].layout = layout;
            updateStoryImagesDisplay(storyId);
        }
        
        function updateDimensions(storyId, dimension, value) {
            if (!storySettings[storyId]) {
                storySettings[storyId] = { layout: 'single', width: 600, height: 300 };
            }
            storySettings[storyId][dimension] = parseInt(value);
            updateStoryImagesDisplay(storyId);
        }
        
        function updateSelectedImagesDisplay(storyId) {
            const container = document.getElementById(`selected-${storyId}`);
            if (!container) return;
            
            const images = selectedImages[storyId] || [];
            
            if (images.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; font-style: italic; margin: 0;">No images selected</p>';
                return;
            }
            
            container.innerHTML = images.map(img => `
                <div class="selected-image">
                    <img src="${img.src}" alt="${img.description}" />
                    <button class="remove-image" onclick="removeImage('${storyId}', ${img.index})" title="Remove image">Ã—</button>
                </div>
            `).join('');
        }
        
        function updateStoryImagesDisplay(storyId) {
            const container = document.getElementById(`images-${storyId}`);
            if (!container) return;
            
            const images = selectedImages[storyId] || [];
            const settings = storySettings[storyId] || { layout: 'single', width: 600, height: 300 };
            
            if (images.length === 0) {
                container.className = 'story-images no-images';
                container.innerHTML = '';
                return;
            }
            
            container.className = 'story-images';
            container.innerHTML = `
                <div class="images-grid layout-${settings.layout}">
                    ${images.map(img => `
                        <div class="image-container" style="max-width: ${settings.width}px;">
                            <img src="${img.src}" 
                                 alt="${img.description}" 
                                 style="height: ${settings.height}px;" />
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function updateSelections() {
            const selectionsDiv = document.getElementById('selections');
            let totalImages = 0;
            let hasSelections = false;
            
            for (const [storyId, images] of Object.entries(selectedImages)) {
                if (images.length > 0) {
                    hasSelections = true;
                    totalImages += images.length;
                }
            }
            
            if (!hasSelections) {
                selectionsDiv.innerHTML = '<p style="color: #6b7280; font-style: italic;">No images selected yet. Click on images in the stories to choose them.</p>';
                return;
            }
            
            let html = '';
            for (const [storyId, images] of Object.entries(selectedImages)) {
                if (images.length === 0) continue;
                
                const storyTitle = document.querySelector(`[data-story="${storyId}"] .story-title`)?.textContent || 'Unknown Story';
                const settings = storySettings[storyId];
                
                html += `
                    <div class="selection-item">
                        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                            ${images.map(img => `<img src="${img.src}" style="width: 40px; height: 30px; object-fit: cover; border-radius: 3px;" />`).join('')}
                        </div>
                        <div>
                            <strong>${storyTitle}</strong> (${images.length} images)<br>
                            <small>Layout: ${settings.layout}, Size: ${settings.width}Ã—${settings.height}px</small>
                        </div>
                    </div>
                `;
            }
            selectionsDiv.innerHTML = `<p><strong>${totalImages} images selected for newsletter</strong></p>` + html;
        }
        
        function exportNewsletter() {
            if (!newsletterData) {
                alert('Please generate newsletter data first');
                return;
            }
            
            // Build clean newsletter HTML from scratch
            let storiesHtml = '';
            
            for (let i = 0; i < newsletterData.stories.length; i++) {
                const story = newsletterData.stories[i];
                const storyId = `story-${i}`;
                const images = selectedImages[storyId] || [];
                const settings = storySettings[storyId] || { layout: 'single', width: 600, height: 300 };
                
                let imagesHtml = '';
                if (images.length > 0) {
                    imagesHtml = `
                        <div class="story-images">
                            <div class="images-grid layout-${settings.layout}">
                                ${images.map(img => `
                                    <div class="image-container" style="max-width: ${settings.width}px;">
                                        <img src="${img.src}" 
                                             alt="${img.description}" 
                                             style="height: ${settings.height}px;" />
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                storiesHtml += `
                    <div class="story ${story.category}">
                        <div class="story-header">
                            <span class="story-emoji">${story.emoji}</span>
                            <h3 class="story-title">${story.title}</h3>
                        </div>
                        <div class="story-location">${story.location}</div>
                        
                        ${imagesHtml}
                        
                        <div class="story-content">
                            ${story.content}
                        </div>
                    </div>
                `;
            }
            
            // Create final HTML with updated styles
            const finalHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Takeoff News Newsletter</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; max-width: 600px; margin: 0 auto; padding: 0; background-color: #f8f9fa; color: #333; }
        .newsletter { background: white; }
        .header { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { margin: 0; font-size: 28px; font-weight: 700; background: linear-gradient(90deg, #10b981, #14b8a6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { margin: 10px 0 0 0; opacity: 0.9; font-size: 16px; }
        .content { padding: 30px; }
        .welcome { font-size: 16px; margin-bottom: 25px; color: #4b5563; }
        .brief-header { background: linear-gradient(90deg, #1f2937, #374151); color: white; padding: 20px 30px; margin: 0 -30px 25px -30px; }
        .brief-header h2 { margin: 0; font-size: 22px; font-weight: 600; }
        .brief-header .date { opacity: 0.8; font-size: 14px; margin-top: 5px; }
        .story { margin-bottom: 25px; border-left: 4px solid #e5e7eb; padding-left: 20px; }
        .story.politics { border-left-color: #fbbf24; }
        .story.conflict { border-left-color: #ef4444; }
        .story.diplomacy { border-left-color: #3b82f6; }
        .story.military { border-left-color: #fbbf24; }
        .story.intelligence { border-left-color: #ef4444; }
        .story.news { border-left-color: #6b7280; }
        .story-header { display: flex; align-items: center; margin-bottom: 8px; }
        .story-emoji { font-size: 18px; margin-right: 8px; }
        .story-title { font-weight: 700; font-size: 18px; color: #1f2937; margin: 0; }
        .story-location { color: #6b7280; font-style: italic; font-size: 14px; margin-bottom: 10px; }
        .story-content { color: #374151; font-size: 15px; line-height: 1.6; }
        .story-images { margin: 15px 0; }
        .images-grid { display: grid; gap: 10px; margin: 15px 0; }
        .images-grid.layout-single { grid-template-columns: 1fr; }
        .images-grid.layout-side-by-side { grid-template-columns: 1fr 1fr; }
        .images-grid.layout-three { grid-template-columns: repeat(3, 1fr); }
        .images-grid.layout-stacked { grid-template-columns: 1fr; }
        .image-container { background: #f3f4f6; border-radius: 6px; margin: 10px 0; overflow: hidden; }
        .image-container img { width: 100%; height: auto; display: block; object-fit: cover; }
        .insight { background: #f3f4f6; border-radius: 6px; padding: 20px; margin: 25px 0; border-left: 4px solid #10b981; }
        .insight-title { font-weight: 600; color: #1f2937; margin-bottom: 10px; }
        .cta { background: #f8fafc; padding: 20px; border-radius: 6px; margin: 25px 0; text-align: center; }
        .footer { background: #f8f9fa; padding: 20px 30px; margin: 25px -30px 0 -30px; font-size: 14px; color: #6b7280; }
        .signature { margin: 20px 0; font-style: italic; }
        .unsubscribe { font-size: 12px; color: #9ca3af; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="newsletter">
        <div class="header">
            <h1>Fast Takeoff News</h1>
            <p>AI-Powered Intelligence Briefing</p>
        </div>
        
        <div class="content">
            <div class="welcome">
                <p><strong>Hi there,</strong></p>
                <p>Welcome to Fast Takeoff News! You're now part of a small, exclusive group of early subscribers getting AI-powered news intelligence straight from global sources.</p>
                <p><strong>What you'll get:</strong> Real-time analysis of breaking news from channels monitoring everything from US politics to Myanmar resistance movements, compiled by AI and verified by human oversight.</p>
            </div>
            
            <div class="brief-header">
                <h2>Today's Intelligence Brief</h2>
                <div class="date">${newsletterData.date}</div>
            </div>
            
            ${storiesHtml}
            
            <div class="insight">
                <div class="insight-title">Why this matters:</div>
                These aren't just headlines - they're intelligence patterns. Notice how multiple stories connect across regions and domains, revealing the interconnected nature of global events.
            </div>
            
            <div class="cta">
                <p><strong>What's next:</strong> I'm personally curating these briefings and would love your feedback. What type of analysis interests you most? Geopolitical trends? Economic intelligence? Regional conflicts?</p>
                <p>Just reply to this email - I read every response personally.</p>
            </div>
            
            <div class="signature">
                <p>Best,<br>
                <strong>Guilherme</strong><br>
                Founder, Fast Takeoff News</p>
            </div>
            
            <div class="footer">
                <p><strong>P.S.</strong> - If you know someone who'd value real-time intelligence analysis, share: <a href="https://news.fasttakeoff.org">news.fasttakeoff.org</a></p>
                
                <div class="unsubscribe">
                    <p><em>You're receiving this because you signed up at news.fasttakeoff.org. Unsubscribe anytime.</em></p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;
            
            // Download the file
            const blob = new Blob([finalHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'fast-takeoff-newsletter-' + new Date().toISOString().split('T')[0] + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Also log selections to console for debugging
            console.log('Newsletter data:', newsletterData);
            console.log('Selected images:', selectedImages);
            console.log('Story settings:', storySettings);
        }
    </script>
</body>
</html>
